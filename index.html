<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friday Night Funkin' Thoth Mod v1 Download & Demo Release</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom CSS (Glass Styles) -->
    <link rel="stylesheet" href="style.css">
</head>

<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Main Glass Container -->
    <div class="glass-container p-8 md:p-12 rounded-xl shadow-2xl w-full max-w-lg text-center">

        <!-- Header -->
        <img src="images/title-shortened.png" class="mx-auto mb-4" />
        <p class="text-white/80 mb-8 text-lg">Mod Assets & Playtest Access</p>

        <!-- Download Button -->
        <button id="downloadButton" onclick="startDownload()"
            class="glass-button w-full mb-4 px-6 py-3 text-xl font-bold rounded-lg shadow-lg
                   transition duration-300 transform hover:scale-[1.02]">
            Download All Mod Files
        </button>

        <!-- Demo Button -->
        <a href="demo.html"
            class="glass-button inline-block w-full px-6 py-3 text-xl font-bold rounded-lg shadow-lg
                   transition duration-300 transform hover:scale-[1.02] text-center">
            Play Test Demo
        </a>

        <!-- Status -->
        <div id="statusMessage"
            class="glass-status mt-6 p-3 rounded-lg text-white/90 text-sm hidden"></div>

    </div>

<!-- JSZip + FileSaver -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
// Parallax background script
// This script makes the background image move slightly based on mouse movement.

// Adjust these values to change movement intensity
const intensity = 20; // higher = more movement, lower = subtle

window.addEventListener('mousemove', (e) => {
    const x = (e.clientX / window.innerWidth - 0.5) * intensity;
    const y = (e.clientY / window.innerHeight - 0.5) * intensity;

    document.body.style.backgroundPosition = `${50 + x}% ${50 + y}%`;
});

// Ensure background color stays solid red (#ff0000)
document.body.style.backgroundColor = '#ff0000';
</script>
<script>
/* Status message */
function showStatus(msg, cls = "bg-slate-700") {
    const box = document.getElementById("statusMessage");
    box.className = "mt-6 p-3 rounded-lg text-slate-200 text-sm " + cls;
    box.textContent = msg;
    box.classList.remove("hidden");
}

/* Recursively walk GitHub folders and insert files into ZIP */
async function addFolderToZip(zip, apiURL, basePath = "") {
    const res = await fetch(apiURL);
    if (!res.ok) throw new Error("GitHub API error: " + res.status);

    const items = await res.json();

    for (const item of items) {
        const relativePath = item.path.replace("thoth_mod_v1/", "");

        if (item.type === "file") {
            showStatus(`Adding file: ${relativePath}`, "bg-yellow-800");

            const fileRes = await fetch(item.download_url);
            const blob = await fileRes.blob();

            zip.file(relativePath, blob);
        }

        else if (item.type === "dir") {
            showStatus(`Entering folder: ${relativePath}`, "bg-blue-800");

            const sub = zip.folder(relativePath);
            await addFolderToZip(sub, item.url, relativePath);
        }
    }
}

/* Main function */
async function startDownload() {
    const btn = document.getElementById("downloadButton");
    btn.disabled = true;
    btn.innerHTML = "Building ZIP...";

    showStatus("Fetching GitHub folder list...", "bg-yellow-800");

    const zip = new JSZip();

    try {
        await addFolderToZip(
            zip,
            "https://api.github.com/repos/thothmod/thothmod.github.io/contents/thoth_mod_v1"
        );

        showStatus("Generating ZIP file...", "bg-indigo-800");

        const content = await zip.generateAsync({ type: "blob" });

        saveAs(content, "thoth_mod_v1.zip");

        showStatus("ZIP complete! Download should begin now.", "bg-green-800");
    }
    catch (err) {
        console.error(err);
        showStatus("Error: " + err.message, "bg-red-800");
    }

    btn.disabled = false;
    btn.innerHTML = "Download All Mod Files";
}
</script>

<audio id="bgm" src="Thehouseonthehill.mp3" autoplay loop muted></audio>
<script>
// Guaranteed audio unmute & play after first click:
window.addEventListener("click", () => {
    const bgm = document.getElementById("bgm");
    bgm.muted = false;
    bgm.play().catch(e => console.log("Playback blocked:", e));
}, { once: true });
</script>
</body>
</html>
